<%- include('../partials/header') %>

<div class="container py-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Chỉnh Sửa Lịch Học</h5>
                </div>
                <div class="card-body">
                    <form action="/academic/schedule/<%= schedule._id %>" method="POST">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="name" class="form-label">Tên lớp <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" value="<%= schedule.name %>" required>
                            </div>
                            <div class="col-md-6">
                                <label for="teacherId" class="form-label">Giáo viên <span class="text-danger">*</span></label>
                                <select class="form-select" id="teacherId" name="teacherId" required>
                                    <option value="">-- Chọn giáo viên --</option>
                                    <% if (teachers && teachers.length > 0) { %>
                                        <% teachers.forEach(function(teacher) { %>
                                            <option value="<%= teacher._id %>" 
                                                <%= schedule.teacher && schedule.teacher._id.toString() === teacher._id.toString() ? 'selected' : '' %>>
                                                <%= teacher.name %>
                                            </option>
                                        <% }); %>
                                    <% } %>
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Thứ <span class="text-danger">*</span></label>
                                <div class="d-flex flex-wrap gap-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="monday" name="dayOfWeek[]" 
                                            value="Monday" <%= schedule.dayOfWeek.includes('Monday') ? 'checked' : '' %>>
                                        <label class="form-check-label" for="monday">Thứ 2</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="tuesday" name="dayOfWeek[]" 
                                            value="Tuesday" <%= schedule.dayOfWeek.includes('Tuesday') ? 'checked' : '' %>>
                                        <label class="form-check-label" for="tuesday">Thứ 3</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="wednesday" name="dayOfWeek[]" 
                                            value="Wednesday" <%= schedule.dayOfWeek.includes('Wednesday') ? 'checked' : '' %>>
                                        <label class="form-check-label" for="wednesday">Thứ 4</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="thursday" name="dayOfWeek[]" 
                                            value="Thursday" <%= schedule.dayOfWeek.includes('Thursday') ? 'checked' : '' %>>
                                        <label class="form-check-label" for="thursday">Thứ 5</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="friday" name="dayOfWeek[]" 
                                            value="Friday" <%= schedule.dayOfWeek.includes('Friday') ? 'checked' : '' %>>
                                        <label class="form-check-label" for="friday">Thứ 6</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="saturday" name="dayOfWeek[]" 
                                            value="Saturday" <%= schedule.dayOfWeek.includes('Saturday') ? 'checked' : '' %>>
                                        <label class="form-check-label" for="saturday">Thứ 7</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="sunday" name="dayOfWeek[]" 
                                            value="Sunday" <%= schedule.dayOfWeek.includes('Sunday') ? 'checked' : '' %>>
                                        <label class="form-check-label" for="sunday">Chủ nhật</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-6">
                                        <label for="startTime" class="form-label">Giờ bắt đầu <span class="text-danger">*</span></label>
                                        <input type="time" class="form-control" id="startTime" name="startTime" value="<%= schedule.startTime %>" required>
                                    </div>
                                    <div class="col-6">
                                        <label for="endTime" class="form-label">Giờ kết thúc <span class="text-danger">*</span></label>
                                        <input type="time" class="form-control" id="endTime" name="endTime" value="<%= schedule.endTime %>" required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="location" class="form-label">Địa điểm</label>
                                <input type="text" class="form-control" id="location" name="location" value="<%= schedule.location || '' %>" placeholder="Phòng học">
                            </div>
                            <div class="col-md-6">
                                <label for="status" class="form-label">Trạng thái</label>
                                <select class="form-select" id="status" name="status">
                                    <option value="active" <%= schedule.status === 'active' ? 'selected' : '' %>>Đang hoạt động</option>
                                    <option value="inactive" <%= schedule.status === 'inactive' ? 'selected' : '' %>>Tạm dừng</option>
                                    <option value="completed" <%= schedule.status === 'completed' ? 'selected' : '' %>>Đã kết thúc</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="studentIds" class="form-label">Học sinh</label>
                            <select class="form-select" id="studentIds" name="studentIds" multiple>
                                <% if (students && students.length > 0) { %>
                                    <% students.forEach(function(student) { %>
                                        <option value="<%= student._id %>" 
                                            <%= schedule.students.some(s => s._id.toString() === student._id.toString()) ? 'selected' : '' %>>
                                            <%= student.name %> - <%= student.class %>
                                        </option>
                                    <% }); %>
                                <% } %>
                            </select>
                            <small class="text-muted">Giữ Ctrl để chọn nhiều học sinh.</small>
                        </div>

                        <div class="mt-4 d-flex justify-content-between">
                            <a href="/academic/schedule" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> Quay lại
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Lưu thay đổi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/footer') %> 